{% extends "base.html" %}
{% block conteudo %}
<div class="container mt-4">
<div class="row justify-content-center">
<div class="col-lg-8 col-md-10 col-sm-12">
<div class="card shadow-sm">
<div class="card-header fw-bold">Cadastro de Produtos</div>
<div class="card-body">
<form method="post" class="row g-3">
<div class="col-md-4">
<input class="form-control" name="codigo" placeholder="Código de barras" value="{{ produto_edicao[1] if produto_edicao else '' }}" >
</div>
<div class="col-md-5">
<input class="form-control" name="descricao" placeholder="Descrição" value="{{ produto_edicao[2] if produto_edicao else '' }}" >
</div>
<div class="col-md-3">
<input class="form-control" name="preco" placeholder="Preço" step="0.01" value="{{ produto_edicao[3] if produto_edicao else '' }}" >
</div>
<div class="col-12 d-flex flex-column gap-2">
  <button type="submit" name="acao" value="consultar" class="btn btn-info w-100">Consultar</button>
  <button type="submit" name="acao" value="salvar" class="btn btn-primary w-100">Salvar</button>
  <button type="submit" name="acao" value="deletar" class="btn btn-danger w-100">Deletar</button>
</div>


</form>
<div class="text-center mt-3">
    <svg id="barcode"></svg>
</div>
</div>
</div>
<div class="card mt-4 shadow-sm">
<div class="card-body p-0">
<div class="table-responsive">
<table class="table table-striped table-hover mb-0">
<thead class="table-dark">
<tr>
<th>Código</th>
<th>Descrição</th>
<th class="text-end">Preço</th>
</tr>
</thead>

<tbody>
{% for p in produtos %}
<tr onclick="window.location='{{ url_for('produto.produtos', editar_id=p[0]) }}'" style="cursor:pointer;">
<td>{{ p[1] }}</td>
<td>{{ p[2] }}</td>
<td class="text-end">R$ {{ "%.2f"|format(p[3])|replace(".",",") }}</td>
</tr>
{% endfor %}
</tbody>

</tbody>

</table>
</div>
<nav class="p-3">
<ul class="pagination justify-content-center mb-0">

<li class="page-item {% if page==1 %}disabled{% endif %}">
<a class="page-link" href="{{ url_for('produto.produtos',page=page-1) }}">Anterior</a>
</li>

<li class="page-item {% if page==1 %}active{% endif %}">
<a class="page-link" href="{{ url_for('produto.produtos',page=1) }}">1</a>
</li>

{% if page > 4 %}
<li class="page-item disabled"><span class="page-link">...</span></li>
{% endif %}

{% for p in range(page-2,page+3) %}
{% if p > 1 and p < total_pages %}
<li class="page-item {% if p==page %}active{% endif %}">
<a class="page-link" href="{{ url_for('produto.produtos',page=p) }}">{{ p }}</a>
</li>
{% endif %}
{% endfor %}

{% if page < total_pages-3 %}
<li class="page-item disabled"><span class="page-link">...</span></li>
{% endif %}

{% if total_pages > 1 %}
<li class="page-item {% if page==total_pages %}active{% endif %}">
<a class="page-link" href="{{ url_for('produto.produtos',page=total_pages) }}">{{ total_pages }}</a>
</li>
{% endif %}

<li class="page-item {% if page==total_pages %}disabled{% endif %}">
<a class="page-link" href="{{ url_for('produto.produtos',page=page+1) }}">Próxima</a>
</li>

</ul>
</nav>

</div>
</div>
</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
<script>
function gerarCodigoDeBarras(valor){
    if(!valor){
        document.getElementById("barcode").innerHTML=""
        return
    }
    JsBarcode("#barcode", valor, {
        format: "CODE128",
        lineColor: "#000",
        width: 2,
        height: 60,
        displayValue: true
    })
}
document.addEventListener("DOMContentLoaded", function(){
    const inputCodigo=document.querySelector("input[name='codigo']")
    gerarCodigoDeBarras(inputCodigo.value)
    inputCodigo.addEventListener("input", function(){
        gerarCodigoDeBarras(this.value)
    })
})
</script>

{% endblock %}

